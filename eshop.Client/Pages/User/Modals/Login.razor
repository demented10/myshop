
@inject HttpClient Http
@inject NavigationManager NavManager
@inject CustomAuthenticationStateProvider CustomAuthStateProvider
@inject UserService UserService
@using Microsoft.AspNetCore.Authorization;
@using eshop.Client.Services
<EditForm Model="@model" OnValidSubmit="HandleLogin">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <InputText class="form-control" id="username" @bind-Value="model.Username" placeholder="Имя пользователя" />
    <br />
    <InputText class="form-control" type="password" id="password" @bind-Value="model.Password" placeholder="Пароль" />
    <br />
    <button type="submit" class="btn btn-primary">Войти</button>
</EditForm>

@code {
    [CascadingParameter] public BlazoredModalInstance ModalInstance { get; set; } = default!;
    private LoginModel model = new LoginModel();
    private async Task HandleLogin()
    {
        try
        {
            await CustomAuthStateProvider.LoginAsync(model.Username, model.Password);
            await ModalInstance.CloseAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }

    public class LoginModel
    {
        public string Username { get; set; } = "";
        public string Password { get; set; } = "";
    }

    public class AuthResponse
    {
        public string Token { get; set; } = "";
    }
}